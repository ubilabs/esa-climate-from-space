steps:
  - name: 'gcr.io/cloud-builders/npm'
    entrypoint: npm
    args: ['ci']
  - name: 'gcr.io/cloud-builders/npm'
    entrypoint: npm
    args: ['run', 'build']
  - name: 'gcr.io/cloud-builders/gsutil'
    args: ['rsync', '-r', '-d', './dist', 'gs://esa-cfs-versions/web/${BRANCH_NAME}']
  - name: 'gcr.io/cloud-builders/gsutil'
    args:
      [
        'acl',
        'ch',
        '-r',
        '-u',
        'AllUsers:R',
        'gs://esa-cfs-versions/web/${BRANCH_NAME}/*',
      ]
  - name: 'gcr.io/cloud-builders/gsutil'
    args:
      [
        'setmeta',
        '-h',
        'cache-control:no-cache',
        'gs://esa-cfs-versions/web/${BRANCH_NAME}/*',
      ]
  - name: 'gcr.io/cloud-builders/curl'
    args: [
      '--data',
      '{"text": "New deployment from outer space is ready -> <https://storage.googleapis.com/esa-cfs-versions/web/${BRANCH_NAME}/index.html> (commit: <https://github.com/ubilabs/esa-climate-from-space/commit/${COMMIT_SHA}>)"}',
      '${_SLACK_HOOK_URL}'
    ]

